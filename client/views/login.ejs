<!doctype html>
<html lang="en">
	<head>
	<%- include('./common/head', it); %>
	</head>
	<body class="loginContainer">
	<script src="/node/jquery/dist/jquery.min.js" type="text/javascript"></script>
	<%- include('./common/scripts/admScripts', it); %>
		<main class="login">
			<form id="loginForm" action="/api/login" method="POST" enctype="multipart/form-data">
				<h3>Iniciar Sesion en Cchan</h3>
				<h5>Si posees una cuenta de Cchan, introduce las credenciales a continuacion:</h5>
				<div class="inputs">
					<input type="text" class="modalInput" name="userid" id="userid" placeholder="ID o Nick del Usuario" value="<%= it.sesion.uid %>">
					<input type="text" class="modalInput" name="password" id="password" placeholder="Contraseña">
					<input type="hidden" name="_csrf_token" id="_csrf_token" value="<%= it.sesion.simpleCsrfToken %>">
				</div>
				<h5>La sesion abierta en otro dispositivo se invalidará</h5>
				<h5>Al presionar <b>iniciar sesion</b> aceptas las <a href="/info/reglas">reglas del sitio</a>.</h5>	
	
				<div class="loginFormButtons">
					<button class="buttonPress" id="loginButton">
						<i id="loadingLogin" class="fas fa-circle-notch fa-spin hidden"></i>
						<span id="loginText">Iniciar Sesion</span>
					</button>
				</div>
				<div style="text-align: center;font-size:11px"><a href="/">Volver al Inicio</a></div>
			</form>
		</main>
	</body>
	<%- include('./common/footer', it); %>
</html>

<script>
	if (element("loginButton")){
		element("loginButton").addEventListener("click", function(e){
			e.preventDefault();
			let userid = element("userid").value;
			let password = element("password").value;
			let formdata = new FormData();
			
			formdata.append("userid", userid);
			formdata.append("password", password);
			
			post(formdata, "/api/login", function(){
				element("loadingLogin").classList.remove("hidden");
				element("loginText").classList.add("hidden");
			}, function(result){
				element("loadingLogin").classList.add("hidden");
				element("loginText").classList.remove("hidden");
				if (result.success){
					window.location.replace("/");
				} else {
					alert(result.data);
				}
			});
			
		});
	}
</script>

<style>

	.login h3 {
		text-align: center;
	}
	
	.login a {
		color: cyan;
	}
	
	.login a:hover {
		color: #ff8100;
	}
	
	form h5 {
		margin: 10px;
		font-weight: inherit;
		font-size: 0.9rem;
	}

	.loginContainer {
		position: inherit;
		display: flex;
		justify-content: center;
		margin-top: 20vh;
	}
	
	.login {
		width: 25rem;
		height: auto;
		background: var(--modalbox-background);
		position: fixed;
		top: 50%;
		left: 50%;
		transform: translate(-50%,-50%);
	}
	
	.inputs {
		text-align: center;
	}
	
	.login form {
		padding: 10px;
		border: 1px solid var(--modal-border);
	}

	.login input {
		width: 94%;
		padding: 10px;
		margin-bottom: 10px;
	}
	
	.loginFormButtons {
		display: flex;
		justify-content: center;
	}
	
	.loginFormButtons button {
		margin-right: 10px;
	}	
</style>