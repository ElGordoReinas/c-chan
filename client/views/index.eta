<!doctype html>
<html lang="en">
<head>
<%~ includeFile('./common/head', it); %>
<!-- El navbar se renderiza primero -->
<%~ includeFile('./common/header', it); %>
</head>
<body>
	<div class="boxList" id="boxList">
		<% 
			it.data.boxs.forEach(function(box){
				renderBox(box);
			});
				
		%>
	</div>		
</body>
<%~ includeFile('./common/footer', it); %>
</html>


<!-- FRAGMENTOS DE HTML -->
<!-- FUNCION: renderiza un elemento box con los datos especificados. -->
<% function renderBox(box) { %>
	<% if (box != undefined) { %>
		<a class="box" data-vox id="<%= box.bid %>" href="/tema/<%= box.bid %>" style="background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.3)), url(<%= box.img %>); text-decoration: none; background-position: top;">
		<div class="voxHeader">
			<div class="tagList">
				<div class="tag categoryTag">
					<img src="assets/<%= getCategory(box.cat).icon %>" style="width: 20px;vertical-align: middle;"><%= box.cat.toUpperCase() %></img>
				</div>
				<% if (box.sticky > 0){ %>
					<div class="tag sticky">Sticky</div>
				<% } %>
				<% if (box.csticky != undefined && box.csticky > 0){ %>
					<div class="tagInvisible csticky"><div class="tagWrapperTransparent"></div><i class="fas fa-thumbtack"></i></div>
				<% } %>
				<% if (box.video != undefined && box.video){ %>
					<div class="tagInvisible ytb"><div class="tagWrapper"></div><i class="fab fa-youtube"></i></div>
				<% } %>
				<% if (box.poll != undefined && box.poll){ %>
					<div class="tagInvisible pollTag"><div class="tagWrapper"></div><i class="fas fa-poll"></i></div>
				<% } %>
				<% if (box.flag != undefined && box.flag === "rss"){ %>
					<div class="tagInvisible rss"><div class="tagWrapperTransparent"></div><i class="fas fa-rss"></i></div>
				<% } %>
				<% if (box.flag != undefined && box.flag === 1){ %>
					<div class="tagInvisible pollTag"><div class="tagWrapper"></div><i class="fas fa-dice-three"></i></div>
				<% } %>
			</div>
			<div class="voxComments textShadon">
				<i class="fas fa-comment"></i>
				<span class="countComments"><%= box.comments %></span>
			</div>
			<div class="voxAction textShadon">
				<div class="actionBotton" data-voxaction="<%= box.bid %>">
					<i class="fas fa-ellipsis-v" data-voxaction="<%= box.bid %>"></i>
				</div>
			</div>
		</div>
		
		<% if (box.data != undefined && box.data.anime != undefined && box.data.anime != ""){ %>
			<h5 class="animetitle textShadon"><%= box.data.anime %></h5>
		<% } %>
		<h4 class="title textShadon"><%= box.title %></h4>
		<div class="over"></div>
		<div class="voxActions unselect">
			<div class="voxActionBotton">
				<% if (box.cat != "hide") { %>
					<div class="actionText" data-act="hide" data-contentid="<%= box.bid %>">Ocultar</div>
				<% } else { %>
					<div class="actionText" data-act="hide" data-contentid="<%= box.bid %>">Mostrar</div>
				<% } %>
			</div>
			<div class="voxActionBotton">
				<% if (it.data.juid != ""){ %>
					<div class="actionText" data-act="report" data-contentid="<%= box.bid %>">Advertir</div>
				<% } else { %>
					<div class="actionText" data-act="report" data-contentid="<%= box.bid %>">Reportar</div>
				<% } %>
			</div>
			<div class="voxActionBotton">
				<div class="actionText" data-act="close"><i class="fas fa-times"></i></div>
			</div>
		</div>
	</a>
	<% } %>
<% } %>

<%
	/* FUNCIONES UTILITARIAS */
	function getCategory(tid){
		return it.data.categorias.filter( item => item.tid === tid)[0];
	}
%>